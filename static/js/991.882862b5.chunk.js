"use strict";(self.webpackChunksayfire_app=self.webpackChunksayfire_app||[]).push([[991],{7991:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Me});var n=s(8563),i=s(3550),o=s(5954),a=s(1951),l=s(7313),r=s(2751),d=s(5323),c=s(9175);function u(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function h(e,t,s){const n=[...e];if(t<0||t>=e.length||s<0||s>=e.length)return n;const[i]=n.splice(t,1);return n.splice(s,0,i),n}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return s=Math.max(Math.min(s,1),0),new Promise((n=>{const i=new Image;i.src=e,i.onload=()=>{const e=document.createElement("canvas"),o=Math.min(i.width,t),a=o/i.width;e.width=o,e.height=i.height*a;e.getContext("2d").drawImage(i,0,0,e.width,e.height);const l=e.toDataURL("image/jpeg",s);n(l)}}))}const x="notifications",m={id:x,name:"Chat notifications",description:"New chat messages",importance:4,visibility:0,lights:!0,vibration:!0};c.s.createChannel(m);const g={};function f(e,t){if(g[e]){const t={notifications:g[e].notifications};c.s.cancel(t)}else t||setTimeout((()=>{f(e,!0)}),1e3)}function j(){c.s.removeAllDeliveredNotifications()}var v=s(4661);const y=new Audio("/assets/message.mp3");let b;!function(e){e[e.MessageReceived=0]="MessageReceived",e[e.MessageSent=1]="MessageSent",e[e.InformationLabel=2]="InformationLabel"}(b||(b={}));class C{constructor(e){this.waitMs=void 0,this.waitMs=e}postprocess(e){return this.waitMs}}class w{constructor(e,t){this.pageId=void 0,this.updateDate=void 0,this.pageId=e,this.updateDate=t}postprocess(e){if("END"===this.pageId)return e.currentNode=null,e.currentPage=null,null;const t=e.story.pages.find((e=>e.id===this.pageId));return console.log("search for page",this.pageId,!!t),t&&t.nodes.length>0?(e.currentPage=t,e.currentNode=t.nodes[0]):(e.currentNode=null,e.currentPage=null),e.lastUpdate=this.updateDate,null}}class T{constructor(e){this.updateDate=void 0,this.updateDate=e}postprocess(e){var t,s;const n=(null===(t=e.currentPage)||void 0===t?void 0:t.nodes.findIndex((t=>{var s;return t.id===(null===(s=e.currentNode)||void 0===s?void 0:s.id)})))||0;if(n+1>=((null===(s=e.currentPage)||void 0===s?void 0:s.nodes.length)||0)){var i;console.log("node next has reached end of page");const t=e.story.pages.findIndex((t=>{var s;return t.id===(null===(s=e.currentPage)||void 0===s?void 0:s.id)}));e.currentNode=(null===(i=e.story.pages[t+1])||void 0===i?void 0:i.nodes[0])||null,e.currentPage=e.story.pages[t+1]||null}else{var o,a,l,r;console.log("next node",n,null===(o=e.currentPage)||void 0===o?void 0:o.nodes[0].id,null===(a=e.currentNode)||void 0===a?void 0:a.id,null===(l=e.currentPage)||void 0===l?void 0:l.nodes.findIndex((t=>{var s;return t.id===(null===(s=e.currentNode)||void 0===s?void 0:s.id)}))),e.currentNode=(null===(r=e.currentPage)||void 0===r?void 0:r.nodes[n+1])||null}return e.lastUpdate=this.updateDate,null}}class S{postprocess(e){return null}}function N(e,t){const s=null===e||void 0===e?void 0:e.jumpToPage;return s&&"NEXT"!==s?(console.log("jump to page",s),new w(s,t)):new T(t)}function I(e,t,s){t.isOnline=!0,t.isWritting=!0;const n=e.fields.value||"",i=e.fields.image||null;const o=Number.parseInt(e.fields.writeTime)||function(e){return 1500+80*e.length}(n),a=new Date(t.lastUpdate.getTime()+o),l=a.getTime()-Date.now();if(console.log("still has to wait",l),l>0)return new C(l);if(n.length||i){const e={type:b.MessageReceived,text:n,image:i,date:a};t.lastMessage=e,t.unreadMessages+=1,t.history.messages.push(e),Math.abs(l)<1e3&&function(){try{y.play(),v.ej.vibrate({duration:100})}catch(e){console.error(e)}}()}return N(e.fields,a)}function k(e,t,s){const n=e.fields.options||[];let i;const o=e.fields.template||"$value";if(0!==n.length){const e=function(e){var t,s,n=0;for(t=0;t<e.length;t++)n+=e[t];for(s=Math.random()*n,t=0;t<e.length;t++){if(s<e[t])return t;s-=e[t]}return-1}(n.map((function(e){return e.weight||1})));i=n[e],i.value=o.replace(/\$value/g,i.value)}return void 0!==i?(e.type="say",e.fields={...e.fields,...i},console.log('convert "sayRandom" node into "say" for option',e.fields.value),I(e,t)):N(e.fields,t.lastUpdate)}function D(e,t,s){const n=e.fields.randomRange;let i;const o=e.fields.template||"$value";if(n){const e=u(n.min||0,n.max||0);i={value:o.replace(/\$value/g,e.toString())}}return void 0!==i?(e.type="say",e.fields={...e.fields,...i},console.log('convert "sayRandom" node into "say" for option',e.fields.value),I(e,t)):N(e.fields,t.lastUpdate)}function F(e,t,s){if(void 0===e.fields.value&&e.fields.randomRange&&e.fields.randomRange.min&&e.fields.randomRange.max){const t=Number.parseInt(e.fields.randomRange.min),s=Number.parseInt(e.fields.randomRange.max);e.fields.value=u(t,s)}const n=Number.parseInt(e.fields.value)||1e3;console.log("wait for...",n);const i=new Date(t.lastUpdate.getTime()+n),o=i.getTime()-Date.now();return o>0?new C(o):N(e.fields,i)}function R(e,t,s){if(console.log("choice node",s),void 0!==s){console.log("user picked reply number",s);const n=(e.fields.options||[])[s],i=new Date;if(n){const e={type:b.MessageSent,text:n.value,image:null,date:i};return t.lastMessage=e,t.history.messages.push(e),N(n,i)}return N(e.fields,i)}const n=Number.parseInt(e.fields.waitFor)||1/0,i=new Date(t.lastUpdate.getTime()+n);let o=i.getTime()-Date.now();if(n===1/0&&(o=1/0),o>0){const s=e.fields.options||[];return 0===(null===s||void 0===s?void 0:s.length)?N(e.fields,t.lastUpdate):(t.replies=null===s||void 0===s?void 0:s.map((e=>e.value)),console.log("replies set to",t.replies),n===1/0?new S:new C(o))}{const t=e.fields.jumpToPage;return t?new w(t,i):new T(i)}}function P(e,t,s){return console.log("jump to page node"),N(e.fields,t.lastUpdate)}class A{static register(e,t){this.processors[e]=t}static call(e,t,s){if(this.preprocess(t),null!==e){const n=e.type;return this.processors[n](e,t,s).postprocess(t)}return null}static preprocess(e){null!==e.nextTimout&&(clearTimeout(e.nextTimout),e.nextTimout=null),null!==e.nextNotification&&(f(e.nextNotification),e.nextNotification=null),e.replies=null,e.isOnline=!1,e.isWritting=!1}}A.processors={},A.register("say",I),A.register("sayRandom",k),A.register("randomNumber",D),A.register("wait",F),A.register("choice",R),A.register("jumpToPage",P);var O=s(5274),L=s(7387),$=s(8545);const E="store-";function M(e){return JSON.stringify(e)}function G(e){const t=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/;return JSON.parse(e,((e,s)=>"string"==typeof s&&t.exec(s)?new Date(s):s))}const Y={save:function(e,t){console.time("save");const s=M(t),n=$.Z.encrypt(s);localStorage.setItem(E+e,n),console.timeEnd("save")},load:function(e){console.time("load");let t=null;const s=localStorage.getItem(E+e);if(s){t=G($.Z.decrypt(s))}return console.timeEnd("load"),t},clear:function(e){localStorage.removeItem(E+e)},serialize:M,deserialize:G};var W=s(7121);class U extends L.yh{constructor(e,t){super(Y.load(e)||t),this.storeName=void 0,this.storeName=e;const s=(0,W.P)(1e3,(t=>{Y.save(e,t)}),{noLeading:!1,noTrailing:!1});this.subscribe((e=>e),(e=>{s(e)}))}forceSave(){const e=this.getRawState();Y.save(this.storeName,e)}}const V=U;const Z=class extends V{constructor(e){super(e,{chats:{}}),this.runningChats={},this.getState=e=>e,this.chatsSelector=(0,d.P1)(this.getState,(e=>Object.values(e.chats))),this.chatSelector=e=>(0,d.P1)(this.getState,(t=>t.chats[e]));const t=this.getRawState();Object.values(t.chats).forEach((e=>{this.run(e.id)})),O.g.addListener("appStateChange",(e=>{let{isActive:t}=e;console.log("App state changed",t,"Resume/pause chats"),t?(this.resumeAllChats(),j()):this.pauseAllChats()})),j(),this.destroyAllPlayTestChats()}run(e){e in this.runningChats?console.warn("Chat",e,"already running"):(this.runningChats[e]=!0,this.createReaction((t=>{var s,n;return null===(s=t.chats[e])||void 0===s||null===(n=s.currentNode)||void 0===n?void 0:n.id}),((t,s)=>{console.log("refresh chat ->",e);const n=s.chats[e];n&&this.refreshChat(n)})),this.callRefreshForChat(e),setInterval((()=>{this.callRefreshForChat(e)}),3e4+1e3*Math.random()))}pauseAllChats(){Object.keys(this.runningChats).forEach((e=>{this.runningChats[e]=!1}))}resumeAllChats(){Object.keys(this.runningChats).forEach((e=>{this.runningChats[e]=!0,this.callRefreshForChat(e)}))}refreshChat(e,t){var s,n;const i=e.currentNode,o=null===(s=e.currentNode)||void 0===s?void 0:s.id,a=e.id;let l=A.call(i,e,t);if(null!==l){console.log("waiting for node",null===i||void 0===i?void 0:i.id,l,"ms"),e.nextTimout=setTimeout((()=>this.callRefreshForChat(a)),l);const t=Date.now()+l+1e4;e.nextNotification=function(e,t,s){const n=u(-2147483648,2147483647),i={notifications:[{id:n,title:t,body:s,channelId:x,schedule:{at:e,allowWhileIdle:!0}}]};return c.s.schedule(i).then((e=>{g[n]=e})),n}(new Date(t),`${e.contact.name}`,"You may have new messages")}o!==(null===(n=e.currentNode)||void 0===n?void 0:n.id)&&(e.nextTimout=setTimeout((()=>this.callRefreshForChat(a)),0))}callRefreshForChat(e,t){!0===this.runningChats[e]&&this.update((s=>{const n=s.chats[e];n&&this.refreshChat(n,t)}))}createChat(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=(0,r.x0)();return this.update((o=>{const a={id:i,isPlayTest:n,contact:e,story:t,currentPage:t.pages[s],currentNode:t.pages[s].nodes[0],replies:null,history:{messages:[]},isOnline:!1,isWritting:!1,lastMessage:null,lastUpdate:new Date,nextNotification:null,nextTimout:null,unreadMessages:0};o.chats[i]=a})),this.run(i),i}destroyChat(e){delete this.runningChats[e],this.update((t=>{const s=t.chats[e];s&&(null!==s.nextNotification&&f(s.nextNotification),null!==s.nextTimout&&clearTimeout(s.nextTimout),delete t.chats[e])}))}destroyAllPlayTestChats(){const e=this.getRawState().chats;Object.values(e).forEach((e=>{e.isPlayTest&&this.destroyChat(e.id)}))}sendReply(e,t){this.callRefreshForChat(e,t)}markAllAsRead(e){this.update((t=>{const s=t.chats[e];s&&(s.unreadMessages=0)}))}useChats(){return this.useState(this.chatsSelector)}useChat(e){return this.useState(this.chatSelector(e))||null}};const _=new class extends V{constructor(e){super(e,{stories:{}}),this.defaultPageNodes=[{id:(0,r.x0)(),type:"say",fields:{value:"Hello"}},{id:(0,r.x0)(),type:"jumpToPage",fields:{jumpToPage:"NEXT"}}],this.getState=e=>e,this.storiesSelector=(0,d.P1)(this.getState,(e=>Object.values(e.stories))),this.storySelector=e=>(0,d.P1)(this.getState,(t=>t.stories[e]))}createNewStory(e){const t=(0,r.x0)();this.update((s=>{const n={id:t,title:e,pages:[{id:(0,r.x0)(),name:"Page 1",nodes:this.defaultPageNodes}],createdAt:new Date,updatedAt:new Date};s.stories[t]=n}))}addStory(e){this.update((t=>{const s=e.id;t.stories[s]=e}))}deleteStory(e){this.update((t=>{t.stories[e]&&delete t.stories[e]}))}renameStory(e,t){this.update((s=>{const n=s.stories[e];n&&(n.title=t,n.updatedAt=new Date)}))}addPageToStory(e,t){this.update((s=>{const n=s.stories[e];if(n){const e={id:(0,r.x0)(),name:t,nodes:this.defaultPageNodes};n.pages.push(e),n.updatedAt=new Date}}))}deletePageFromStory(e,t){this.update((s=>{const n=s.stories[e];n&&(n.pages.splice(t,1),n.updatedAt=new Date)}))}renamePageFromStory(e,t,s){this.update((n=>{const i=n.stories[e];if(i){const e=i.pages[t];e&&(e.name=s,i.updatedAt=new Date)}}))}reorderPageFromStory(e,t,s){this.update((n=>{const i=n.stories[e];i&&(i.pages=h(i.pages,t,s),i.updatedAt=new Date)}))}addNodeToStory(e,t,s,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.update((o=>{const a=o.stories[e];if(a){const e=a.pages[t];if(e&&e.nodes){const t={id:(0,r.x0)(),type:s,fields:n};i&&e.nodes.length>0?e.nodes.splice(e.nodes.length-1,0,t):e.nodes.push(t),a.updatedAt=new Date}}}))}deleteNodeFromStory(e,t,s){this.update((n=>{const i=n.stories[e];if(i){const e=i.pages[t];e&&e.nodes&&(e.nodes=e.nodes.filter((e=>e.id!==s)),i.updatedAt=new Date)}}))}updateNodeFieldFromStory(e,t,s,n,i){this.update((o=>{const a=o.stories[e];if(a){const e=a.pages[t];if(e&&e.nodes){const t=e.nodes.find((e=>e.id===s));t&&(t.fields[n]=i,a.updatedAt=new Date)}}}))}reorderNodeFromStory(e,t,s,n){this.update((i=>{const o=i.stories[e];if(o){const e=o.pages[t];e&&(e.nodes=h(e.nodes,s,n),o.updatedAt=new Date)}}))}useStories(){return this.useState(this.storiesSelector)}useStory(e){return this.useState(this.storySelector(e))||null}}("stories"),Q=new Z("chats");var z=s(6617);function q(e){const t=(new Date).getTime()-e.getTime(),s=864e5;return t>6048e5?(0,z.Z)(e,"MMM dd"):t>s?(0,z.Z)(e,"eeee"):(0,z.Z)(e,"HH:mm")}const K=(0,s(6877).Z)((e=>Y.load(e)),{maxAge:3e5});function H(){return Object.keys(localStorage).filter((e=>e.includes("asset-")))}const X={save:function(e,t){const s=t||`asset-${(0,r.x0)()}`;return Y.save(s,e),s},load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e&&K(e)||t},remove:function(e){Y.clear(e)},encryptAll:function(e){H().forEach((t=>{const s=localStorage.getItem(t),n=$.Z.encrypt(s,e);localStorage.setItem(t,n)}))},decryptAll:function(e){H().forEach((t=>{const s=localStorage.getItem(t),n=$.Z.decrypt(s,e);localStorage.setItem(t,n)}))}};var B=s(6417);const J=e=>{const{id:t,contact:s,lastMessage:i,unreadMessages:o,isWritting:l}=e.chat,r=X.load(s.photo,"/assets/blank.png"),d=i?q(i.date):void 0,c=l?(0,B.jsxs)("span",{children:[(0,B.jsx)("b",{style:{color:"var(--ion-color-primary)"},children:"writting... "}),(0,B.jsx)("span",{children:null===i||void 0===i?void 0:i.text})]}):null!==i&&void 0!==i&&i.text?i.type===b.MessageSent?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(n.gu,{icon:a.nT7,color:"primary"}),(0,B.jsx)("span",{children:i.text})]}):(0,B.jsx)("span",{children:i.text}):(0,B.jsx)("span",{children:(0,B.jsx)("i",{children:"New contact"})});return(0,B.jsx)("div",{className:"chat-row",id:"chat-row",children:(0,B.jsxs)(n.Ie,{className:"chat-content-container",routerLink:`/view/chat/${t}`,detail:!1,children:[(0,B.jsx)(n.BJ,{slot:"start",className:"chat-avatar",children:(0,B.jsx)("img",{alt:"Contact avatar",src:r})}),(0,B.jsxs)("div",{className:"chat-content",children:[(0,B.jsx)("div",{className:"chat-name-date",children:(0,B.jsx)("h2",{children:s.name})}),(0,B.jsx)("p",{className:"ion-text-wrap",children:c})]}),(0,B.jsxs)("div",{className:"chat-details",children:[(0,B.jsx)("p",{className:`chat-date ${o>0&&"chat-unread"}`,children:d}),o>0&&(0,B.jsx)("div",{className:"chat-notification",children:o})]})]})})},ee=()=>{const e=Q.useChats();e.sort(((e,t)=>{var s,n;return((null===(s=t.lastMessage)||void 0===s?void 0:s.date.getTime())||t.lastUpdate.getTime())-((null===(n=e.lastMessage)||void 0===n?void 0:n.date.getTime())||e.lastUpdate.getTime())}));const t=(0,l.useRef)();return(0,B.jsxs)(n._i,{ref:t,children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"end",children:(0,B.jsx)(n.YG,{fill:"clear",routerLink:"/tabs/stories",children:(0,B.jsx)(n.gu,{icon:a.UOY})})}),(0,B.jsx)(n.wd,{children:"Chats"})]})}),(0,B.jsxs)(n.W2,{fullscreen:!0,children:[(0,B.jsx)(n.Gu,{collapse:"condense",children:(0,B.jsx)(n.sr,{children:(0,B.jsx)(n.wd,{size:"large",children:"Chats"})})}),e.map((e=>(0,B.jsx)(J,{chat:e},e.id)))]})]})},te=e=>{const{editable:t,onClick:s}=e,{id:i,title:o,updatedAt:l}=e.story,r=q(l);return(0,B.jsx)("div",{className:"chat-row",id:"chat-row",children:(0,B.jsxs)(n.Ie,{className:"chat-content-container",button:!0,onClick:s,detail:!1,children:[(0,B.jsxs)("div",{className:"chat-content",children:[(0,B.jsx)("div",{className:"chat-name-date",children:(0,B.jsx)("h2",{children:o})}),(0,B.jsxs)("p",{className:"ion-text-wrap",children:["Last modified ",r]})]}),(0,B.jsx)(n.Sm,{slot:"end",style:{marginInlineStart:"-54px"},children:t&&(0,B.jsx)(n.YG,{onClick:e=>e.stopPropagation(),routerLink:`/view/editstory/${i}`,children:(0,B.jsx)(n.gu,{icon:a.Tvs})})})]})})},se="InputModal_floatingModal__HYrD3";var ne=s(2036);async function ie(e,t){const s=await ne.G.pickFiles({types:e,multiple:!1,readData:!0});if(s.files&&s.files.length&&s.files[0].data){const e=s.files[0].mimeType,n=s.files[0].data;return null!==t&&void 0!==t&&t.returnDataURI?`data:${e};base64,${n}`:n}}const oe=e=>{const{imageSrc:t,placeholderSrc:s,onImagePicked:i,onImageCleared:o,imageStyle:a}=e;return(0,B.jsxs)(n.jY,{children:[(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(t||s)&&(0,B.jsx)(n.Xz,{style:a,src:t||s})})}),(0,B.jsxs)(n.Nd,{children:[(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.YG,{expand:"block",fill:"solid",onClick:async()=>{const e=await async function(){return await ie(["image/png","image/jpeg"],{returnDataURI:!0})}();e&&i(e)},children:[void 0===t?"Open":"Change"," image"]})}),void 0!==o&&void 0!==t&&(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"block",fill:"outline",disabled:void 0===t,onClick:o,children:"Remove"})})]})]})},ae=e=>{const{title:t,defaultValue:s,isOpen:i,onClose:o,inputType:a,selectData:r,inputLabel:d,inputPlaceholder:c,submitLabel:u,onSubmit:h,altActionLabel:p,onAltAction:x,submitValidator:m}=e,[g,f]=(0,l.useState)(s),j=void 0===m||m(g);(0,l.useEffect)((()=>{f(s)}),[s]);const v=()=>{j&&(h(g||c),o(),f(s))};(0,l.useEffect)((()=>{if(i)try{const e=async()=>{var e;const t=await(null===(e=document.getElementById("focus-input"))||void 0===e?void 0:e.getInputElement());null===t||void 0===t||t.focus()};setTimeout(e,100),setTimeout(e,300),setTimeout(e,600),setTimeout(e,900)}catch(e){console.log(e)}}),[i]);return(0,B.jsxs)(n.ki,{class:se,isOpen:i,canDismiss:!0,onDidDismiss:()=>{o(),f(s)},children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[void 0!==t&&(0,B.jsx)(n.wd,{children:t}),(0,B.jsxs)(n.Sm,{slot:"end",children:[void 0!==p&&(0,B.jsx)(n.YG,{fill:"clear",onClick:()=>{void 0!==x&&x(),o(),f(s)},children:p}),(0,B.jsx)(n.YG,{fill:"clear",onClick:v,disabled:!j,children:u})]})]})}),(0,B.jsx)(n.q_,{lines:"full",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:(()=>{if("select"===a){const e=[];return null===r||void 0===r||r.forEach(((t,s)=>{e.push((0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{children:t}),(0,B.jsx)(n.B7,{slot:"start",value:s})]},s))})),(0,B.jsxs)(n.se,{value:g,onIonChange:e=>f(e.target.value),children:[void 0!==d&&(0,B.jsx)(n.yh,{children:(0,B.jsx)(n.Q$,{children:d})}),e]})}return"image"===a?(0,B.jsx)(oe,{imageSrc:g,onImagePicked:f,imageStyle:{height:"50vh"}}):(0,B.jsxs)(n.Ie,{children:[void 0!==d&&(0,B.jsx)(n.Q$,{position:"stacked",children:d}),(0,B.jsx)(n.pK,{id:"focus-input",type:a,placeholder:c||s,value:g,onIonInput:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v()}})]})})()})]})};var le=s(9229);const re=e=>{const{isOpen:t,onClose:s,onSubmit:i}=e,[o,a]=(0,l.useState)(""),[r,d]=(0,l.useState)(void 0);return(0,B.jsxs)(n.ki,{style:{"--height":"350px"},isOpen:t,onDidDismiss:()=>s(),children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.YG,{onClick:()=>s(),children:"Close"})}),(0,B.jsx)(n.wd,{children:"Contact details"}),(0,B.jsx)(n.Sm,{slot:"end",children:(0,B.jsx)(n.YG,{onClick:()=>(async()=>{const e=r?X.save(await p(r)):"";i({name:o||"Unknown",photo:e})})(),children:"Create"})})]})}),(0,B.jsx)(n.W2,{className:"ion-padding",children:(0,B.jsxs)(n.jY,{children:[(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsx)(oe,{placeholderSrc:"/assets/blank.png",imageSrc:r,imageStyle:{height:"100px"},onImagePicked:d,onImageCleared:()=>d(void 0)})})}),(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{position:"floating",children:"Contact name"}),(0,B.jsx)(n.pK,{onIonChange:e=>a(e.detail.value||""),placeholder:"Display name"})]})})})]})})]})};const de={exportData:function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=null!==s,i=[];e.forEach((e=>{i.push(...function(e){const t=[];return e.pages.forEach((e=>{e.nodes.forEach((e=>{e.fields.image&&t.push(e.fields.image),e.fields.options&&e.fields.options.forEach((e=>{e.image&&t.push(e.image)}))}))})),t}(e))}));const o={stories:e,chats:t,assets:i.reduce(((e,t)=>({...e,[t]:X.load(t)})),{})},a={version:1,encrypted:n,data:n?$.Z.encrypt(Y.serialize(o),s):o},l=`sayfire_export_${Date.now()}.json`;console.log(l,a),function(e,t){const s=document.createElement("a"),n=t.split(".").pop();s.href=URL.createObjectURL(new Blob([e],{type:`text/${"txt"===n?"plain":n}`})),s.download=t,s.click()}(Y.serialize(a),l)},importData:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=await ie(["application/json"]);if(t){const s=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")),n=Y.deserialize(s);if(n.encrypted&&null===e)throw new Error("Decryption password required");const i=n.encrypted?Y.deserialize($.Z.decrypt(n.data,e||void 0)):n.data;if(i.stories&&i.stories.forEach((e=>{_.addStory(e)})),i.chats&&i.chats.forEach((e=>{throw new Error("Chat import not yet implemented")})),i.assets)for(const e in i.assets)X.save(i.assets[e],e)}}},ce=e=>{const{isOpen:t,onClose:s,story:i}=e,[o,a]=(0,l.useState)("");return(0,B.jsxs)(n.ki,{style:{"--height":"350px"},isOpen:t,onDidDismiss:()=>s(),children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.YG,{onClick:()=>s(),children:"Close"})}),(0,B.jsx)(n.wd,{children:"Export story"})]})}),(0,B.jsx)(n.W2,{className:"ion-padding",children:(0,B.jsxs)(n.jY,{children:[(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{position:"floating",children:"Password (optional)"}),(0,B.jsx)(n.pK,{onIonChange:e=>a(e.detail.value||""),placeholder:"Password"})]})})}),(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"full",fill:"solid",onClick:()=>(async()=>{de.exportData([i],[],o||null),s()})(),children:"Export"})})})]})})]})};function ue(){const[e]=(0,n.Yn)();return function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Yes",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"No";return new Promise((i=>{e({header:t,buttons:[{text:s,role:"confirm"},{text:n,role:"cancel"}],onWillDismiss:e=>{"confirm"===e.detail.role?i(!0):i(!1)}})}))}}const he=e=>{const t=(0,o.k6)(),{isOpen:s,onClose:i,onDescriptionChange:l,story:r}=e,d=r?q(r.updatedAt):"",c=r?q(r.createdAt):"",u=ue(),[h,p]=(0,le.Z)(!1),x=(0,B.jsx)(ae,{title:"Story title",defaultValue:null===r||void 0===r?void 0:r.title,isOpen:h,onClose:()=>p(!1),submitLabel:"Rename",onSubmit:e=>{r&&_.renameStory(r.id,e),i()},submitValidator:e=>!!e}),[m,g]=(0,le.Z)(!1),f=(0,B.jsx)(re,{isOpen:m,onClose:()=>g(!1),onSubmit:e=>{g(!1),i(),r&&(Q.createChat(e,r),t.push("/tabs/chats"))}}),[j,v]=(0,le.Z)(!1),y=(0,B.jsx)(ce,{isOpen:j,onClose:()=>v(!1),story:r});return(0,B.jsxs)(n.ki,{style:{"--height":"350px"},isOpen:s,onDidDismiss:()=>i(),children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.YG,{onClick:()=>i(),children:"Close"})}),(0,B.jsx)(n.wd,{children:null===r||void 0===r?void 0:r.title})]})}),(0,B.jsxs)(n.W2,{className:"ion-padding",children:[(0,B.jsxs)(n.jY,{children:[(0,B.jsxs)(n.Nd,{style:{marginTop:"0rem"},children:[(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.YG,{expand:"block",shape:"round",fill:"outline",size:"large",onClick:()=>i(),routerLink:`/view/editstory/${null===r||void 0===r?void 0:r.id}`,children:[(0,B.jsx)(n.gu,{slot:"start",icon:a.Tvs}),"Edit"]})}),(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.YG,{expand:"block",shape:"round",fill:"solid",size:"large",onClick:()=>g(!0),children:[(0,B.jsx)(n.gu,{slot:"start",icon:a.AO3}),"Play"]})})]}),(0,B.jsx)(n.Nd,{style:{marginTop:"0rem"},children:(0,B.jsx)(n.wI,{})}),(0,B.jsxs)(n.Nd,{style:{textAlign:"center",marginTop:"2rem"},children:[(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.uN,{children:["Last modified:",(0,B.jsx)("br",{}),d]})}),(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.uN,{children:["Created:",(0,B.jsx)("br",{}),c]})}),(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.uN,{children:["Original author:",(0,B.jsx)("br",{}),"You"]})})]}),(0,B.jsxs)(n.Nd,{style:{marginTop:"2rem"},children:[(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"block",fill:"outline",color:"medium",size:"default",onClick:()=>p(!0),children:"Rename"})}),(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"block",fill:"outline",color:"medium",size:"default",onClick:()=>(async()=>{r&&await u("Are you sure you want to delete this story?")&&(_.deleteStory(r.id),i())})(),children:"Delete"})}),(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"block",fill:"outline",color:"medium",size:"default",onClick:()=>v(!0),children:"Export"})})]})]}),x,f,y]})]})},pe=e=>{const{isOpen:t,onClose:s}=e,[i,o]=(0,l.useState)(""),[a,r]=(0,l.useState)("");return(0,B.jsxs)(n.ki,{style:{"--height":"350px"},isOpen:t,onDidDismiss:()=>s(),children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.YG,{onClick:()=>s(),children:"Close"})}),(0,B.jsx)(n.wd,{children:"Import story"})]})}),(0,B.jsx)(n.W2,{className:"ion-padding",children:(0,B.jsxs)(n.jY,{children:[(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{position:"floating",children:"Password (if any)"}),(0,B.jsx)(n.pK,{onIonChange:e=>o(e.detail.value||""),placeholder:"Password"})]})})}),(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:(0,B.jsx)(n.YG,{expand:"full",fill:"solid",onClick:()=>(async()=>{try{await de.importData(i||null),s()}catch(e){console.error(e),r(String(e))}})(),children:"Import"})})}),(0,B.jsx)(n.Nd,{children:(0,B.jsx)(n.wI,{children:a})})]})})]})},xe=()=>{const e=_.useStories();e.sort(((e,t)=>t.updatedAt.getTime()-e.updatedAt.getTime()));const[t,s]=(0,le.Z)(!1),[i,o]=(0,l.useState)(void 0),r=(0,B.jsx)(ae,{title:"New story",defaultValue:"",inputPlaceholder:"Untitled Story",isOpen:t,onClose:()=>s(!1),submitLabel:"Create",onSubmit:e=>{_.createNewStory(e)},altActionLabel:"Import",onAltAction:()=>c(!0)}),[d,c]=(0,le.Z)(!1),u=(0,B.jsx)(pe,{isOpen:d,onClose:()=>c(!1)}),h=(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"end",children:(0,B.jsxs)(n.YG,{fill:"clear",onClick:()=>s(!0),children:[(0,B.jsx)(n.gu,{icon:a.s6O}),"New story"]})}),(0,B.jsx)(n.wd,{children:"Stories"})]}),p=e.map((e=>(0,B.jsx)(te,{story:e,onClick:()=>(e=>{o(e)})(e),editable:!0},e.id))),x=(0,B.jsx)(he,{story:i,onClose:()=>o(void 0),onDescriptionChange:()=>{},isOpen:void 0!==i});return(0,B.jsxs)(n._i,{children:[(0,B.jsx)(n.Gu,{children:h}),(0,B.jsxs)(n.W2,{children:[p,r,x,u]})]})},me=e=>{const{contentId:t,pages:s,onPageSelected:i,onAddPage:o,onReorder:l}=e,r=s.map(((e,t)=>(0,B.jsxs)(n.Ie,{button:!0,onClick:()=>i(t),children:[(0,B.jsxs)(n.Q$,{children:[(0,B.jsx)("b",{children:t+1})," \xb7 ",e.name]}),(0,B.jsx)(n.Nh,{slot:"end"})]},e.id))),[d,c]=(0,le.Z)(!1),u=`Page ${s.length+1}`,h=(0,B.jsx)(ae,{title:"New page",defaultValue:u,isOpen:d,onClose:()=>c(!1),submitLabel:"Create",onSubmit:o});return(0,B.jsxs)(n.z0,{contentId:t,side:"end",swipeGesture:!1,children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{color:"tertiary",children:[(0,B.jsx)(n.wd,{children:"Pages"}),(0,B.jsx)(n.Sm,{slot:"end",children:(0,B.jsxs)(n.YG,{fill:"clear",onClick:()=>c(!0),children:[(0,B.jsx)(n.gu,{icon:a.s6O})," New page"]})})]})}),(0,B.jsxs)(n.W2,{children:[(0,B.jsx)(n.q_,{children:(0,B.jsx)(n.oz,{disabled:!1,onIonItemReorder:l,children:r})}),h]})]})},ge=e=>{const{onAddNode:t}=e,s=[{type:"say",icon:a.UOY,desc:"Say something",defaultFields:{value:""}},{type:"sayRandom",icon:a.JCQ,desc:"Say random",defaultFields:{options:[{id:(0,r.x0)(),value:""},{id:(0,r.x0)(),value:""}]}},{type:"randomNumber",icon:a.SDb,desc:"Say number",defaultFields:{randomRange:{min:1,max:6}}},{type:"choice",icon:a.z6l,desc:"Reply",defaultFields:{options:[{id:(0,r.x0)(),value:""}]}},{type:"wait",icon:a.CLl,desc:"Wait some time",defaultFields:{value:1e4}}].map(((e,s)=>(0,B.jsx)(n.W4,{"data-desc":e.desc,onClick:()=>t(e.type,e.defaultFields),children:(0,B.jsx)(n.gu,{icon:e.icon})},s)));return(0,B.jsxs)(n.IJ,{slot:"fixed",horizontal:"end",vertical:"bottom",children:[(0,B.jsx)(n.W4,{children:(0,B.jsx)(n.gu,{icon:a.s6O})}),(0,B.jsx)(n.zq,{side:"top",children:s})]})},fe=e=>{const{icon:t,name:s,chips:i,onConfigClick:o,reorderable:l,configurable:r,children:d}=e,c=i.map((e=>(0,B.jsxs)(n.hM,{onClick:t=>{t.preventDefault(),t.stopPropagation(),e.onClick()},children:[(0,B.jsx)(n.gu,{icon:e.icon}),(0,B.jsx)(n.Q$,{children:e.text})]},e.text)));return(0,B.jsxs)(n.Ie,{button:!1,lines:"full",style:{alignItems:"baseline"},children:[(0,B.jsx)(n.gu,{icon:t,slot:"start",style:{marginInlineEnd:"-3px",marginTop:"8px"}}),(0,B.jsxs)(n.Q$,{children:[(0,B.jsx)("h3",{style:{marginLeft:"15px",color:"rgba(var(--ion-text-color-rgb, 0, 0, 0), 0.54)",fontWeight:"normal"},children:s}),(0,B.jsx)("div",{style:{marginLeft:"4px",overflowX:"auto"},children:c}),(0,B.jsx)("div",{children:(0,B.jsx)(n.q_,{lines:"full",children:d})})]}),(0,B.jsx)(n.Sm,{slot:"end",style:{marginInlineStart:"-54px"},children:r&&(0,B.jsx)(n.YG,{onClick:o,children:(0,B.jsx)(n.gu,{icon:a.C$N})})}),l&&(0,B.jsx)(n.Nh,{slot:"end",style:{marginInlineStart:"6px"}})]})},je=e=>{const{editingField:t,fields:s,updateField:n,onClose:i}=e;return(void 0!==t?(0,B.jsx)(ae,{title:t.title,defaultValue:t.loadTransform(void 0!==s[t.field]?s[t.field]:t.defaultValue),isOpen:!0,onClose:()=>i(),submitLabel:t.saveLabel,onSubmit:async e=>n(t.field,await t.saveTransform(e)),altActionLabel:t.resetLabel,onAltAction:t.onReset,inputType:t.inputType,selectData:t.selectData,submitValidator:t.inputValidator}):void 0)||null},ve=e=>{const{header:t,deleteLabel:s,editableFields:i,extraActions:o,isOpen:l,onClose:r,onDelete:d,onEditField:c}=e,u=[...i.map((e=>({text:e.actionText,icon:e.icon,handler:()=>c(e)}))),...o||[],{text:s,icon:a.Ub0,handler:d,role:"destructive"}];return(0,B.jsx)(n.uo,{header:t,isOpen:l,onWillDismiss:r,buttons:u})},ye=e=>{const{node:t,reorderable:s,updateField:i,deleteNode:o}=e,[r,d]=(0,le.Z)(!1),[c,u]=(0,l.useState)(void 0),h=[{field:"writeTime",inputType:"number",actionText:"Override write time",title:"Write time (ms)",getChipText:e=>`${e} ms`,icon:a.hkG,defaultValue:1e3,saveLabel:"Save",resetLabel:"Default",saveTransform:e=>parseInt(e),loadTransform:e=>e,inputValidator:e=>{const t=parseInt(e);return!isNaN(t)&&t>0},onReset:()=>i("writeTime",void 0)},{field:"image",inputType:"image",actionText:"Attached image",title:"Attached image",getChipText:e=>"Image",icon:a.Eu9,defaultValue:void 0,saveLabel:"Save",resetLabel:"None",saveTransform:async e=>(t.fields.image&&X.remove(t.fields.image),X.save(await p(e))),loadTransform:e=>X.load(e),inputValidator:e=>void 0!==e&&e!==X.load(t.fields.image),onReset:()=>{t.fields.image&&X.remove(t.fields.image),i("image",void 0)}}],x=[];return h.forEach((e=>{const s=t.fields[e.field];void 0!==s&&x.push({icon:e.icon,text:e.getChipText(s),onClick:()=>u(e)})})),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(fe,{icon:a.UOY,name:"Say",chips:x,onConfigClick:()=>d(!0),reorderable:s,configurable:!0,children:(0,B.jsx)(n.Ie,{children:(0,B.jsx)(n.g2,{placeholder:"Incoming text...",value:t.fields.value,onIonInput:e=>i("value",e.target.value),autoGrow:!0,rows:1})})}),(0,B.jsx)(ve,{header:"Node configuration",deleteLabel:"Delete node",editableFields:h,isOpen:r,onClose:()=>d(!1),onDelete:o,onEditField:u}),(0,B.jsx)(je,{editingField:c,fields:t.fields,updateField:i,onClose:()=>u(void 0)})]})},be=e=>{const{option:t,optionNumber:s,updateField:i,deleteOption:o,pagesMap:r}=e,[d,c]=(0,le.Z)(!1),[u,h]=(0,l.useState)(void 0),x=[{field:"writeTime",inputType:"number",actionText:"Override write time",title:"Write time (ms)",getChipText:e=>`${e} ms`,icon:a.hkG,defaultValue:1e3,saveLabel:"Save",resetLabel:"Default",saveTransform:e=>parseInt(e),loadTransform:e=>e,inputValidator:e=>{const t=parseInt(e);return!isNaN(t)&&t>0},onReset:()=>i("writeTime",void 0)},{field:"image",inputType:"image",actionText:"Attached image",title:"Attached image",getChipText:e=>"Image",icon:a.Eu9,defaultValue:void 0,saveLabel:"Save",resetLabel:"None",saveTransform:async e=>(t.image&&X.remove(t.image),X.save(await p(e))),loadTransform:e=>X.load(e),inputValidator:e=>void 0!==e&&e!==X.load(t.image),onReset:()=>{t.image&&X.remove(t.image),i("image",void 0)}},{field:"weight",inputType:"number",actionText:"Set option weight",title:"Option weight",getChipText:e=>`${e} times`,icon:a.qlh,defaultValue:1,saveLabel:"Save",resetLabel:"Default",saveTransform:e=>parseFloat(e),loadTransform:e=>e,inputValidator:e=>{const t=parseFloat(e);return!isNaN(t)&&1!==t},onReset:()=>i("weight",void 0)},{field:"jumpToPage",inputType:"select",selectData:r,actionText:"Then go to page",title:"Go to page",getChipText:e=>r.get(e)||"Page deleted \u26a0\ufe0f",icon:a.kY2,defaultValue:void 0,saveLabel:"Save",resetLabel:"None",saveTransform:e=>e,loadTransform:e=>e,inputValidator:e=>void 0!==e&&void 0!==r.get(e),onReset:()=>i("jumpToPage",void 0)}],m=[];x.forEach((e=>{const s=t[e.field];void 0!==s&&m.push({icon:e.icon,text:e.getChipText(s),onClick:()=>h(e)})}));const g=m.map((e=>(0,B.jsxs)(n.hM,{onClick:e.onClick,children:[(0,B.jsx)(n.gu,{icon:e.icon}),(0,B.jsx)(n.Q$,{children:e.text})]},e.text)));return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(n.Ie,{style:{alignItems:"baseline"},children:[(0,B.jsx)(n.Nh,{slot:"start",style:{marginInlineEnd:"6px",marginTop:"11px",marginLeft:"-15px"}}),(0,B.jsxs)("div",{style:{marginLeft:g.length?"-8px":"0px"},children:[(0,B.jsx)(n.g2,{placeholder:`Option ${s+1}`,value:t.value,onIonInput:e=>i("value",e.target.value),autoGrow:!0,rows:1}),(0,B.jsx)("div",{style:{marginLeft:"4px",maxWidth:"70vw",overflowX:"auto",marginTop:"-12px"},children:g})]}),(0,B.jsxs)(n.Sm,{slot:"end",style:{marginTop:"11px",marginInlineStart:"-80px"},children:[(0,B.jsx)(n.YG,{onClick:()=>h(x[3]),children:(0,B.jsx)(n.gu,{icon:a.kY2})}),(0,B.jsx)(n.YG,{onClick:()=>c(!0),children:(0,B.jsx)(n.gu,{icon:a.C$N})})]})]}),(0,B.jsx)(ve,{header:"Option configuration",deleteLabel:"Delete option",editableFields:x,isOpen:d,onClose:()=>c(!1),onDelete:o,onEditField:h}),(0,B.jsx)(je,{editingField:u,fields:t,updateField:i,onClose:()=>h(void 0)})]})},Ce=e=>{const{node:t,reorderable:s,updateField:i,deleteNode:o,pagesMap:d}=e,[c,u]=(0,le.Z)(!1),[p,x]=(0,l.useState)(void 0),m=[{field:"writeTime",inputType:"number",actionText:"Override write time",title:"Write time (ms)",getChipText:e=>`${e} ms`,icon:a.hkG,defaultValue:1e3,saveLabel:"Save",resetLabel:"Default",saveTransform:e=>parseInt(e),loadTransform:e=>e,inputValidator:e=>{const t=parseInt(e);return!isNaN(t)&&t>0},onReset:()=>i("writeTime",void 0)},{field:"template",inputType:"text",actionText:"Set output template",title:"Output template",getChipText:e=>e,icon:a.Zpo,defaultValue:"You got $value",saveLabel:"Save",resetLabel:"Default",saveTransform:e=>e,loadTransform:e=>e,inputValidator:e=>{const t=String(e);return t.includes("$value")&&"$value"!==t},onReset:()=>i("template",void 0)}],g=[];m.forEach((e=>{const s=t.fields[e.field];void 0!==s&&g.push({icon:e.icon,text:e.getChipText(s),onClick:()=>x(e)})}));const f=[...t.fields.options],j=f.map(((e,t)=>(0,B.jsx)(be,{option:e,optionNumber:t,pagesMap:d,updateField:(e,s)=>((e,t,s)=>{const n={...f[e]};n[t]=s;const o=f;o[e]=n,i("options",o)})(t,e,s),deleteOption:()=>(e=>{const t=f.filter(((t,s)=>s!==e));i("options",t)})(t)},e.id)));return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(fe,{icon:a.JCQ,name:"Randomly say one of",chips:g,onConfigClick:()=>u(!0),reorderable:s,configurable:!0,children:[(0,B.jsx)(n.oz,{disabled:!1,onIonItemReorder:e=>{e.stopPropagation();const t=e.detail.from,s=e.detail.to,n=h(f,t,s);i("options",n),e.detail.complete()},children:j}),(0,B.jsx)(n.Ie,{children:(0,B.jsx)(n.Sm,{slot:"start",style:{marginLeft:"-20px"},children:(0,B.jsxs)(n.YG,{onClick:()=>{i("options",[...f,{id:(0,r.x0)(),value:""}])},children:[(0,B.jsx)(n.gu,{icon:a.s6O}),"Add option"]})})})]}),(0,B.jsx)(ve,{header:"Node configuration",deleteLabel:"Delete node",editableFields:m,isOpen:c,onClose:()=>u(!1),onDelete:o,onEditField:x}),(0,B.jsx)(je,{editingField:p,fields:t.fields,updateField:i,onClose:()=>x(void 0)})]})},we=e=>{var t,s;const{node:i,reorderable:o,updateField:r,deleteNode:d}=e,[c,u]=(0,le.Z)(!1),[h,p]=(0,l.useState)(void 0),x=[{field:"writeTime",inputType:"number",actionText:"Override write time",title:"Write time (ms)",getChipText:e=>`${e} ms`,icon:a.hkG,defaultValue:1e3,saveLabel:"Save",resetLabel:"Default",saveTransform:e=>parseInt(e),loadTransform:e=>e,inputValidator:e=>{const t=parseInt(e);return!isNaN(t)&&t>0},onReset:()=>r("writeTime",void 0)},{field:"template",inputType:"text",actionText:"Set output template",title:"Output template",getChipText:e=>e,icon:a.Zpo,defaultValue:"You got $value",saveLabel:"Save",resetLabel:"Default",saveTransform:e=>e,loadTransform:e=>e,inputValidator:e=>{const t=String(e);return t.includes("$value")&&"$value"!==t},onReset:()=>r("template",void 0)}],m=[];x.forEach((e=>{const t=i.fields[e.field];void 0!==t&&m.push({icon:e.icon,text:e.getChipText(t),onClick:()=>p(e)})}));const g=(0,l.useRef)(null),f=(0,l.useRef)(null),j=(e,t)=>{const s=parseInt(String(e.target.value));return t&&(t.value=String(s)),s};return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(fe,{icon:a.SDb,name:"Say a random number",chips:m,onConfigClick:()=>u(!0),reorderable:o,configurable:!0,children:(0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{children:"Between"}),(0,B.jsx)(n.pK,{ref:g,style:{textAlign:"center"},type:"number","aria-label":"Min",placeholder:"Min",value:null===(t=i.fields.randomRange)||void 0===t?void 0:t.min,onIonInput:e=>{var t;return r("randomRange",{min:j(e,g.current),max:null===(t=i.fields.randomRange)||void 0===t?void 0:t.max})}}),(0,B.jsx)(n.Q$,{children:"and"}),(0,B.jsx)(n.pK,{ref:f,style:{textAlign:"center"},type:"number","aria-label":"Max",placeholder:"Max",value:null===(s=i.fields.randomRange)||void 0===s?void 0:s.max,onIonInput:e=>{var t;return r("randomRange",{min:null===(t=i.fields.randomRange)||void 0===t?void 0:t.min,max:j(e,f.current)})}})]})}),(0,B.jsx)(ve,{header:"Node configuration",deleteLabel:"Delete node",editableFields:x,isOpen:c,onClose:()=>u(!1),onDelete:d,onEditField:p}),(0,B.jsx)(je,{editingField:h,fields:i.fields,updateField:r,onClose:()=>p(void 0)})]})},Te=e=>{const{option:t,optionNumber:s,updateField:i,deleteOption:o,pagesMap:r}=e,[d,c]=(0,le.Z)(!1),[u,h]=(0,l.useState)(void 0),p=[{field:"jumpToPage",inputType:"select",selectData:r,actionText:"Then go to page",title:"Go to page",getChipText:e=>r.get(e)||"Page deleted \u26a0\ufe0f",icon:a.kY2,defaultValue:void 0,saveLabel:"Save",resetLabel:"None",saveTransform:e=>e,loadTransform:e=>e,inputValidator:e=>void 0!==e&&void 0!==r.get(e),onReset:()=>i("jumpToPage",void 0)}],x=[];p.forEach((e=>{const s=t[e.field];void 0!==s&&x.push({icon:e.icon,text:e.getChipText(s),onClick:()=>h(e)})}));const m=x.map((e=>(0,B.jsxs)(n.hM,{onClick:e.onClick,children:[(0,B.jsx)(n.gu,{icon:e.icon}),(0,B.jsx)(n.Q$,{children:e.text})]},e.text)));return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(n.Ie,{style:{alignItems:"baseline"},children:[(0,B.jsx)(n.Nh,{slot:"start",style:{marginInlineEnd:"6px",marginTop:"11px",marginLeft:"-15px"}}),(0,B.jsxs)("div",{style:{marginLeft:m.length?"-8px":"0px"},children:[(0,B.jsx)(n.g2,{placeholder:`Reply ${s+1}`,value:t.value,onIonInput:e=>i("value",e.target.value),autoGrow:!0,rows:1}),(0,B.jsx)("div",{style:{marginLeft:"4px",maxWidth:"70vw",overflowX:"auto",marginTop:"-12px"},children:m})]}),(0,B.jsxs)(n.Sm,{slot:"end",style:{marginTop:"11px",marginInlineStart:"-80px"},children:[(0,B.jsx)(n.YG,{onClick:()=>h(p[0]),children:(0,B.jsx)(n.gu,{icon:a.kY2})}),(0,B.jsx)(n.YG,{onClick:()=>c(!0),children:(0,B.jsx)(n.gu,{icon:a.C$N})})]})]}),(0,B.jsx)(ve,{header:"Option configuration",deleteLabel:"Delete option",editableFields:p,isOpen:d,onClose:()=>c(!1),onDelete:o,onEditField:h}),(0,B.jsx)(je,{editingField:u,fields:t,updateField:i,onClose:()=>h(void 0)})]})},Se=e=>{const{node:t,reorderable:s,updateField:i,deleteNode:o,pagesMap:d}=e,[c,u]=(0,le.Z)(!1),[p,x]=(0,l.useState)(void 0),m=[{field:"waitFor",inputType:"number",actionText:"Set max time to reply",title:"Seconds to reply",getChipText:e=>`For ${e/1e3} s`,icon:a.Go2,defaultValue:6e4,saveLabel:"Save",resetLabel:"Unlimited",saveTransform:e=>1e3*parseInt(e),loadTransform:e=>e/1e3,inputValidator:e=>{const t=parseInt(e);return!isNaN(t)&&t>0},onReset:()=>i("waitFor",void 0)}],g=[];m.forEach((e=>{const s=t.fields[e.field];void 0!==s&&g.push({icon:e.icon,text:e.getChipText(s),onClick:()=>x(e)})}));const f=[...t.fields.options],j=f.map(((e,t)=>(0,B.jsx)(Te,{option:e,optionNumber:t,pagesMap:d,updateField:(e,s)=>((e,t,s)=>{const n={...f[e]};n[t]=s;const o=f;o[e]=n,i("options",o)})(t,e,s),deleteOption:()=>(e=>{const t=f.filter(((t,s)=>s!==e));i("options",t)})(t)},e.id)));return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(fe,{icon:a.z6l,name:"Show reply options",chips:g,onConfigClick:()=>u(!0),reorderable:s,configurable:!0,children:[(0,B.jsx)(n.oz,{disabled:!1,onIonItemReorder:e=>{e.stopPropagation();const t=e.detail.from,s=e.detail.to,n=h(f,t,s);i("options",n),e.detail.complete()},children:j}),(0,B.jsx)(n.Ie,{children:(0,B.jsx)(n.Sm,{slot:"start",style:{marginLeft:"-20px"},children:(0,B.jsxs)(n.YG,{onClick:()=>{i("options",[...f,{id:(0,r.x0)(),value:""}])},children:[(0,B.jsx)(n.gu,{icon:a.s6O}),"Add option"]})})})]}),(0,B.jsx)(ve,{header:"Node configuration",deleteLabel:"Delete node",editableFields:m,isOpen:c,onClose:()=>u(!1),onDelete:o,onEditField:x}),(0,B.jsx)(je,{editingField:p,fields:t.fields,updateField:i,onClose:()=>x(void 0)})]})},Ne=e=>{var t,s;const{node:i,reorderable:o,updateField:r,deleteNode:d}=e,[c,u]=(0,le.Z)(!1),[h,p]=(0,l.useState)(void 0),x=[],m=[];x.forEach((e=>{const t=i.fields[e.field];void 0!==t&&m.push({icon:e.icon,text:e.getChipText(t),onClick:()=>p(e)})}));const g=void 0===i.fields.value&&i.fields.randomRange,f=(0,l.useRef)(null),j=(0,l.useRef)(null),v=(0,l.useRef)(null),y=(e,t)=>{const s=parseInt(String(e.target.value));return t&&(t.value=String(s)),1e3*s},b=[{icon:a.xjG,text:g?"Use specific value":"Use time range",handler:()=>{var e;g?(r("randomRange",void 0),r("value",(null===(e=i.fields.randomRange)||void 0===e?void 0:e.min)||1e3)):(r("value",void 0),r("randomRange",{min:i.fields.value||1e3,max:(i.fields.value||1e3)+1e4}))}}];return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(fe,{icon:a.CLl,name:"Wait for",chips:m,onConfigClick:()=>u(!0),reorderable:o,configurable:!0,children:(0,B.jsxs)(n.Ie,{children:[g?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(n.pK,{ref:j,style:{textAlign:"center"},type:"number","aria-label":"Min",placeholder:"Min",value:(null===(t=i.fields.randomRange)||void 0===t?void 0:t.min)/1e3,onIonInput:e=>{var t;return r("randomRange",{min:y(e,j.current),max:null===(t=i.fields.randomRange)||void 0===t?void 0:t.max})}}),(0,B.jsx)(n.Q$,{children:"to"}),(0,B.jsx)(n.pK,{ref:v,style:{textAlign:"center"},type:"number","aria-label":"Max",placeholder:"Max",value:(null===(s=i.fields.randomRange)||void 0===s?void 0:s.max)/1e3,onIonInput:e=>{var t;return r("randomRange",{min:null===(t=i.fields.randomRange)||void 0===t?void 0:t.min,max:y(e,v.current)})}})]}):(0,B.jsx)(n.pK,{ref:f,style:{textAlign:"left"},type:"number","aria-label":"Time",placeholder:"Time",value:i.fields.value/1e3,onIonInput:e=>r("value",y(e,f.current))}),(0,B.jsx)(n.Q$,{children:"seconds"})]})}),(0,B.jsx)(ve,{header:"Node configuration",deleteLabel:"Delete node",editableFields:x,extraActions:b,isOpen:c,onClose:()=>u(!1),onDelete:d,onEditField:p}),(0,B.jsx)(je,{editingField:h,fields:i.fields,updateField:r,onClose:()=>p(void 0)})]})},Ie=e=>{const{node:t,reorderable:s,updateField:i,pagesMap:o}=e,l=(()=>{switch(t.fields.jumpToPage){case"NEXT":return"next";case"END":return"end";default:return"page"}})(),r=[];return o.forEach(((e,t)=>{r.push((0,B.jsx)(n.n0,{value:t,children:e},t))})),(0,B.jsx)(B.Fragment,{children:(0,B.jsxs)(fe,{icon:a.FMn,name:"Finally",chips:[],onConfigClick:()=>{},reorderable:s,configurable:!1,children:[(0,B.jsx)(n.Ie,{children:(0,B.jsxs)(n.t9,{interface:"popover",value:l,onIonChange:e=>(e=>{var t,s;switch(e){case"next":i("jumpToPage","NEXT");break;case"end":i("jumpToPage","END");break;default:const e=(null===o||void 0===o||null===(t=o.keys())||void 0===t||null===(s=t.next())||void 0===s?void 0:s.value)||"END";i("jumpToPage",e)}})(e.target.value),children:[(0,B.jsx)(n.n0,{value:"next",children:"Go to the next page"}),(0,B.jsx)(n.n0,{value:"end",children:"End chat"}),(0,B.jsx)(n.n0,{value:"page",children:"Go to the page"})]})}),"page"===l&&(0,B.jsx)(n.Ie,{children:(0,B.jsx)(n.t9,{interface:"alert",value:t.fields.jumpToPage,onIonChange:e=>i("jumpToPage",e.target.value),placeholder:"Page deleted \u26a0\ufe0f",children:r})})]})})},ke=e=>{const{page:t,pagesMap:s,onReorderNode:i,updateNodeField:o,deleteNode:a}=e;let l=!1;const r=t.nodes.map(((e,n)=>{const i=n===t.nodes.length-1&&"jumpToPage"===e.type;i&&(l=!0);const r={key:e.id,node:e,updateField:(t,s)=>o(e.id,t,s),deleteNode:()=>a(e.id),reorderable:!i};if(i)return(0,B.jsx)(Ie,{...r,pagesMap:s});switch(e.type){case"say":return(0,B.jsx)(ye,{...r});case"sayRandom":return(0,B.jsx)(Ce,{...r,pagesMap:s});case"randomNumber":return(0,B.jsx)(we,{...r});case"choice":return(0,B.jsx)(Se,{...r,pagesMap:s});case"wait":return(0,B.jsx)(Ne,{...r});default:return(0,B.jsxs)("h5",{children:["Unsupported node '",e.type,"'"]},e.id)}})),d=l?r.slice(0,-1):r,c=l?r[r.length-1]:void 0;return(0,B.jsxs)(n.q_,{style:{width:"100%",maxWidth:"650px",height:"calc(100vh - 56px)",overflowY:"auto"},children:[(0,B.jsx)(n.oz,{disabled:!1,onIonItemReorder:i,children:d}),c]})},De=()=>{const e=(0,o.k6)(),t=(0,o.UO)().id,s=_.useStory(t),i=ue(),[r,d]=(0,l.useState)(0),c=s.pages[r],u=(0,l.useRef)(null),h=e=>{var t;null===(t=u.current)||void 0===t||t.slideTo(e),d(e)},p=async()=>{if(s.pages.length<=1)return;if(!await i("Are you sure you want to delete this page?"))return;const e=r;e>0&&h(e-1),_.deletePageFromStory(t,e)},x=e=>{e.stopPropagation();const s=e.detail.from,n=e.detail.to;_.reorderNodeFromStory(t,r,s,n),e.detail.complete()},m=(e,s,n)=>{_.updateNodeFieldFromStory(t,r,e,s,n)},g=e=>{_.deleteNodeFromStory(t,r,e)},f=t=>{const n=t?r:0,i=Q.createChat({name:"Test",photo:""},s,n,!0);e.push("/view/chat/"+i)};(0,l.useEffect)((()=>Q.destroyAllPlayTestChats()),[]);const[j,v]=(0,le.Z)(!1),y=[{text:"Play from the start",icon:a.AO3,handler:()=>f(!1)},{text:"Rename this page",icon:a.Tvs,handler:()=>k(!0)}];s.pages.length>1&&y.push({text:"Delete this page",icon:a.Ub0,handler:p,role:"destructive"});const b=(0,B.jsx)(n.uo,{header:"Story actions",isOpen:j,onWillDismiss:v,buttons:y}),C=(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.oU,{})}),(0,B.jsx)(n.wd,{children:(0,B.jsx)("div",{className:"chat-contact",onClick:void 0,children:(0,B.jsxs)("div",{className:"chat-contact-details",children:[(0,B.jsxs)("p",{children:[c.name," (",r+1,"/",s.pages.length,")"]}),(0,B.jsx)(n.yW,{color:"medium",children:s.title})]})})}),(0,B.jsxs)(n.Sm,{slot:"end",children:[(0,B.jsx)(n.YG,{fill:"clear",onClick:v,children:(0,B.jsx)(n.gu,{icon:a.Z9b})}),(0,B.jsx)(n.YG,{fill:"clear",onClick:()=>f(!0),children:(0,B.jsx)(n.gu,{icon:a.AO3})}),(0,B.jsx)(n.fG,{children:(0,B.jsx)(n.gu,{icon:a.CiY})})]})]}),w=(0,B.jsx)(me,{contentId:"editor-page",pages:s.pages,onPageSelected:h,onAddPage:e=>{const n=s.pages.length,i=(null===e||void 0===e?void 0:e.trim())||`Page ${n}`;_.addPageToStory(t,i),h(n)},onReorder:e=>{e.stopPropagation();const s=e.detail.from,n=e.detail.to;_.reorderPageFromStory(t,s,n),h(n),e.detail.complete()}}),T=new Map(s.pages.map((e=>[e.id,e.name]))),S=s.pages.map(((e,t)=>(0,B.jsx)(n.A$,{children:(0,B.jsx)(ke,{page:e,pagesMap:T,onReorderNode:x,updateNodeField:m,deleteNode:g})},t))),N=(0,B.jsx)(ge,{onAddNode:(e,s)=>{_.addNodeToStory(t,r,e,s,!0)}}),[I,k]=(0,le.Z)(!1),D=(0,B.jsx)(ae,{title:"Page name",defaultValue:c.name,isOpen:I,onClose:()=>k(!1),submitLabel:"Rename",onSubmit:e=>{_.renamePageFromStory(t,r,e)}});return(0,B.jsxs)(B.Fragment,{children:[w,(0,B.jsxs)(n._i,{id:"editor-page",className:"chat-page",children:[(0,B.jsx)(n.Gu,{children:C}),(0,B.jsxs)(n.W2,{children:[(0,B.jsx)(n.Hr,{options:{initialSlide:r},ref:u,onIonSlideDidChange:async e=>{var t;const s=await(null===(t=u.current)||void 0===t?void 0:t.getActiveIndex());"number"===typeof s&&d(s)},children:S},s.pages.length),b,N,D]})]})]})};const Fe=()=>{const e=ue(),t=function(){const[e]=(0,n.od)();return function(t,s){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return new Promise((i=>{e({header:t,subHeader:s,buttons:[{text:n,role:"confirm"}],onWillDismiss:e=>{i(!0)}})}))}}(),s=(0,B.jsx)(n.Ie,{detail:!0,button:!0,children:(0,B.jsxs)(n.Q$,{children:["Local name",(0,B.jsx)("p",{children:"User"})]})}),i=(0,B.jsx)(n.Ie,{children:(0,B.jsxs)(n.Q$,{children:["Account Id",(0,B.jsx)("p",{children:"None"})]})}),o=(0,B.jsxs)(n.Ie,{children:[(0,B.jsx)(n.Q$,{children:"Color theme"}),(0,B.jsx)(n.t9,{value:"auto",children:(0,B.jsx)(n.n0,{value:"auto",children:"Auto"})})]}),a=$.Z.isEncryptionEnabled(),[l,r]=(0,le.Z)(!1),d=(0,B.jsx)(ae,{inputType:"password",title:"Password",defaultValue:"",inputPlaceholder:"Password to unlock the app",isOpen:l,onClose:()=>r(!1),submitLabel:"Apply",onSubmit:e=>{try{$.Z.enableEncryption(e),_.forceSave(),Q.forceSave(),X.encryptAll(e)}catch(s){console.error(s),t("Failed to enable encryption",String(s))}},submitValidator:e=>e.length>3}),[c,u]=(0,le.Z)(!1),h=(0,B.jsx)(ae,{inputType:"password",title:"Password",defaultValue:"",inputPlaceholder:"Your current password",isOpen:c,onClose:()=>u(!1),submitLabel:"Disable",onSubmit:e=>{try{$.Z.disableEncryption(e),_.forceSave(),Q.forceSave(),X.decryptAll(e)}catch(s){console.error(s),t("Failed to disable encryption",String(s))}},submitValidator:e=>e.length>0}),p=(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(n.Ie,{detail:!1,button:!0,onClick:()=>(async()=>{a?u(!0):await e("WARNING: If you forget the password all your data will be permanently lost","Proceed","Cancel")&&r(!0)})(),children:[(0,B.jsxs)(n.Q$,{children:["Password protection",(0,B.jsx)("p",{children:"Require a password to unlock the app"})]}),(0,B.jsx)(n.ho,{style:{pointerEvents:"none"},checked:a})]}),d,h]}),x=(0,B.jsx)(n.sr,{children:(0,B.jsx)(n.wd,{children:"Settings"})});return(0,B.jsxs)(n._i,{children:[(0,B.jsx)(n.Gu,{children:x}),(0,B.jsx)(n.W2,{children:(0,B.jsxs)(n.q_,{lines:"none",children:[(0,B.jsxs)(n.Ub,{children:[(0,B.jsx)(n.rH,{children:(0,B.jsx)(n.Q$,{children:"Account"})}),s,i]}),(0,B.jsxs)(n.Ub,{children:[(0,B.jsx)(n.rH,{children:(0,B.jsx)(n.Q$,{children:"Appearance"})}),o]}),(0,B.jsxs)(n.Ub,{children:[(0,B.jsx)(n.rH,{children:(0,B.jsx)(n.Q$,{children:"Security"})}),p]})]})})]})},Re=()=>{const e=(0,o.UO)().id,t=(0,o.k6)(),s=Q.useChat(e),{contact:i,history:r,unreadMessages:d,replies:c}=s,u=X.load(i.photo,"/assets/blank.png");let h="";s.isWritting&&(h="writting...");const[p,x]=(0,l.useState)(!1),[m,g]=(0,l.useState)(""),[f,j]=(0,le.Z)(!1),[v,y]=(0,le.Z)(!1),C=(0,l.useRef)();(0,l.useEffect)((()=>{Q.markAllAsRead(e)}),[r.messages.length,d]);const w=(0,l.useMemo)((()=>r.messages.map(((e,t)=>{const s=e.type===b.MessageSent;return(0,B.jsxs)("div",{id:`chatBubble_${t}`,className:"chat-bubble "+(s?"bubble-sent":"bubble-received"),children:[(0,B.jsxs)("div",{id:`chatText_${t}`,children:[null!==e.image&&(0,B.jsx)("img",{src:X.load(e.image)}),e.text,(0,B.jsxs)("span",{className:"chat-bottom-details",id:`chatTime_${t}`,children:[(0,B.jsx)("span",{children:q(e.date)}),s&&(0,B.jsx)(n.gu,{icon:a.nT7,color:"primary",style:{fontSize:"0.8rem"}})]})]}),(0,B.jsx)("div",{className:`bubble-arrow ${s&&"alt"}`})]},t)}))),[r.messages.length]),T=(0,l.useMemo)((()=>(setTimeout((()=>N()),100),null===c||void 0===c?void 0:c.map(((t,s)=>(0,B.jsxs)(n.Ie,{button:!0,detail:!1,onClick:()=>Q.sendReply(e,s),children:[(0,B.jsx)(n.Q$,{style:{whiteSpace:"normal"},children:t}),(0,B.jsx)(n.gu,{color:"primary",icon:a.lWK,slot:"end"})]},s))))),[c]),S=[{text:"Contact details",icon:a.XMB,handler:j},{text:"Delete chat",icon:a.Ub0,handler:()=>{setTimeout((()=>Q.destroyChat(e)),1e3),t.go(-1)},role:"destructive"}];(0,n.qY)((()=>{N(),I(),Q.markAllAsRead(e)}));const N=async()=>{var e;null===(e=C.current)||void 0===e||e.scrollToBottom()},I=()=>{if(!C.current)return;new MutationObserver((()=>{N()})).observe(C.current,{childList:!0})};return(0,B.jsxs)(n._i,{className:"chat-page",children:[(0,B.jsx)(n.Gu,{children:(0,B.jsxs)(n.sr,{children:[(0,B.jsx)(n.Sm,{slot:"start",children:(0,B.jsx)(n.oU,{})}),(0,B.jsx)(n.wd,{children:(0,B.jsxs)("div",{className:"chat-contact",onClick:j,children:[(0,B.jsx)("img",{src:u,alt:"avatar"}),(0,B.jsxs)("div",{className:"chat-contact-details",children:[(0,B.jsx)("p",{children:i.name}),(0,B.jsx)(n.yW,{color:"medium",children:h})]})]})}),!s.isPlayTest&&(0,B.jsxs)(n.Sm,{slot:"end",children:[(0,B.jsx)(n.YG,{fill:"clear",onClick:()=>(g("Notifications are enabled"),void x(!0)),children:(0,B.jsx)(n.gu,{icon:a.iZ5})}),(0,B.jsx)(n.YG,{fill:"clear",onClick:y,children:(0,B.jsx)(n.gu,{icon:a.Z9b})})]})]})}),(0,B.jsxs)(n.W2,{id:"main-chat-content",ref:C,children:[w,(0,B.jsx)(n.uo,{header:"Chat Actions",isOpen:v,onWillDismiss:y,buttons:S}),(0,B.jsx)(n.Px,{color:"primary",isOpen:p,onDidDismiss:()=>x(!1),message:m,position:"bottom",duration:3e3})]}),(0,B.jsxs)(n.fr,{className:"chat-footer",id:"chat-footer",children:[void 0!==T&&(0,B.jsx)(n.q_,{inset:!0,children:T}),null===s.currentNode&&(0,B.jsx)("center",{children:(0,B.jsx)("i",{children:"This chat has ended"})})]}),(0,B.jsx)(n.ki,{isOpen:f,onWillDismiss:j,initialBreakpoint:.6,breakpoints:[0,.6,.9],children:(0,B.jsxs)(n.W2,{className:"ion-padding",children:[(0,B.jsx)(n.Q$,{children:(0,B.jsx)("h1",{children:i.name})}),(0,B.jsx)(n.Xz,{src:u,alt:"Contact profile picture"})]})})]})},Pe=e=>(0,B.jsxs)(n.UN,{children:[(0,B.jsx)(n.jP,{children:e.tabs.map(((e,t)=>{const s=e.component;return e.isTab?(0,B.jsx)(o.AW,{path:e.path,render:e=>(0,B.jsx)(s,{...e}),exact:!0},`tab_route_${t}`):(0,B.jsx)(o.AW,{path:e.path,render:e=>(0,B.jsx)(s,{...e}),exact:!1},`child_tab_route_${t}`)}))}),(0,B.jsx)(n.yq,{slot:e.position,children:e.tabs.map(((e,t)=>{if(e.isTab)return(0,B.jsxs)(n.ZU,{tab:`tab_${t+1}`,href:e.path,children:[(0,B.jsx)(n.gu,{icon:e.icon}),e.label&&(0,B.jsx)(n.Q$,{children:e.label})]},`tab_button_${t+1}`)}))})]}),Ae=e=>(0,B.jsx)(B.Fragment,{children:e.routes.map(((e,t)=>{const s=e.component;return(0,B.jsx)(o.AW,{path:e.path,render:e=>(0,B.jsx)(s,{...e}),exact:!1},t)}))}),Oe=[{label:"Chats",component:ee,icon:a.z6l,path:"/tabs/chats",default:!0,isTab:!0},{label:"Stories",component:xe,icon:a.JZY,path:"/tabs/stories",default:!1,isTab:!0},{label:"Settings",component:Fe,icon:a.C$N,path:"/tabs/settings",default:!1,isTab:!0}],Le=[{component:Re,path:"/view/chat/:id"},{component:De,path:"/view/editstory/:id"}],$e=()=>(0,B.jsx)(Ae,{routes:Le}),Ee=()=>(0,B.jsx)(Pe,{tabs:Oe,position:"bottom"}),Me=()=>(0,B.jsx)(i.tr,{children:(0,B.jsxs)(n.jP,{id:"main",children:[(0,B.jsx)(o.AW,{path:"/tabs",render:()=>(0,B.jsx)(Ee,{})}),(0,B.jsx)($e,{}),(0,B.jsx)(o.AW,{path:"/",component:Oe.filter((e=>e.default))[0].component,exact:!0}),(0,B.jsx)(o.l_,{exact:!0,from:"/",to:Oe.filter((e=>e.default))[0].path.toString()})]})})}}]);